bxp <- ggboxplot(df_d0, x = "TR01PG1", y = "AVAL",
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.6,size=0.2)+ ##ylim = c(0, 9.32)
stat_compare_means(aes(group = TR01PG1), label = "p.signif",size = 2)
#facet_wrap(~ARM)
#p+stat_summary( aes(group = final_var_call,color=final_var_call),fun.y=median, geom="line")
# labs(color=NULL)+
#   labs(fill=NULL)+
#   guides(color=guide_legend(ncol=1))+
#   theme(
#     legend.position = c(1, 1),
#     legend.justification = c("right", "top"),
#     legend.box.just = "right",
#     legend.margin = margin(6,6,6,6)
#     )
bxp ##+ scale_y_continuous(name="Stopping distance", limits=c(0, 8))
#dev.off()
dunn_test(AVAL ~ TR01PG1, data =df_d0 )
##Calculate the median SO day for each variant
#df_d0_med_SO <- subset(df_d0, !(is.na(df_d0$TSYMOR)))
df_d0_med_SO <- subset(df_d0, !(is.na(df_d0$TSYMOR))) %>%
group_by(final_var_call) %>%
summarise(median_SO=median(TSYMOR),
.groups = 'drop')
df_d0_med_SO
#df_d0_new = subset(df_admbvl, AVISITN==0 & MBLOC=='NASOPHARYNX' & !(final_var_call %in% c('Delta', 'Eta','Mu','discordant')))
stat.test <- df_d0 %>%
dunn_test(AVAL ~ TR01PG1) %>%
add_significance()%>%
mutate(y.position = c(0.00085))
stat.test
# Add p-values of `stat.test` and `stat.test2`
# 1. Add stat.test
stat.test <- stat.test %>%
add_xy_position(x = "TR01PG1", dodge = 1)
bxp.complex <- bxp +
stat_pvalue_manual(
stat.test,  label = "p", tip.length =0.0,y.position = 9, step.increase = 0.09
)
bxp.complex
##fig.height = 2, fig.width = 10
data2plot = subset(df_admbvl, AVISITN %in% c(0,3,7,14,28) & MBLOC=='NASAL CAVITY')# & SUBJID %in% unique(df_AZ_IV_PIDs$PID)) ##& primstr=='NPH'
##EXTRACT DSSO INFO FROM ADMB FILE
data2plot <- transform(data2plot, dsso= AVISITN+TSYMOR)
data2plot$dsso <- as.factor(data2plot$dsso)
data2plot$AVISITN <- as.factor(data2plot$AVISITN)
pd = position_dodge(width = 0.7)
ggplot(data2plot, aes(AVISITN, AVAL,color = TR01PG1)) +
#geom_boxplot(aes(visit, final_quanti, color = final_var_call), width=0.7,outlier.shape = NA,lwd=0.4,fatten = 1)
#geom_point(aes(fill=final_var_call, color = final_var_call),shape=21,position=position_jitterdodge(0.2), alpha=0.8,size=0.9)+
geom_point(aes(fill=TR01PG1, color = TR01PG1),position=position_jitter(0.2), alpha=0.8,size=0.9)+
#facet_wrap(~Group) +
stat_compare_means(aes(group = TR01PG1), label = "p.format",size = 3.5)+
stat_summary( aes(group = TR01PG1,color=TR01PG1),fun=mean, geom="line")
##PLOT FOR TRT ARM LINE PLOT
data2plot_1 <- subset(data2plot, ARMINFO =='Active')
ggplot(data2plot_1, aes(AVISITN, AVAL,color = TR01PG1)) +
geom_point(aes(fill=TR01PG1, color = TR01PG1),position=position_jitter(0.2), alpha=0.8,size=0.9)+
geom_smooth(method = lm)+
#stat_compare_means(aes(group = final_var_call), label = "p.format",size = 3.5)+
stat_summary( aes(group = TR01PG1,color=TR01PG1),fun=median, geom="line")
df_mut_count_az <- read.csv('~/Dropbox (Partners HealthCare)/RDEO_iMAC/VL_project/AZ_RD/NEW_ANALYSIS_2023/mut_count_AZIVIM_trt_longformat_Sep23_2023.csv')
df_mut_count_az_sel <- df_mut_count_az
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F,ylim = c(0, 11.5))+ ##,ylim = c(0, 11.5)
stat_compare_means(aes(group = Agent), label = "p.format",size = 3,method='wilcox')
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
##ggsave('~/Dropbox (Partners HealthCare)/RDEO_iMAC/VL_project/AZ_RD/NEW_ANALYSIS_2023/emerging_mutation_count_IV_vs_IM_sep23_2023.pdf')
View(df_mut_count_az)
df_mut_count_az <- read.csv('~/Dropbox (Partners HealthCare)/RDEO_iMAC/VL_project/AZ_RD/NEW_ANALYSIS_2023/mut_count_AZIVIM_trt_longformat_Sep23_2023.csv')
df_mut_count_az_sel <- df_mut_count_az
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F,ylim = c(0, 11.5))+ ##,ylim = c(0, 11.5)
stat_compare_means(aes(group = Agent), label = "p.format",size = 3,method='wilcox')
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
##ggsave('~/Dropbox (Partners HealthCare)/RDEO_iMAC/VL_project/AZ_RD/NEW_ANALYSIS_2023/emerging_mutation_count_IV_vs_IM_sep23_2023.pdf')
dft <- read.csv('/Users/rinkideo/Partners HealthCare Dropbox/Rinki Deo/RDEO_iMAC/VL_project/AZ_RD/NEW_ANALYSIS_2023/gt5freq_heatmaps/mut_count_trtplac_ALLgt5freq_longformat.csv')
View(dft)
df_mut_count_az_sel <- dft
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV","Placebo"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F,ylim = c(0, 11.5))+ ##,ylim = c(0, 11.5)
stat_compare_means(aes(group = Agent), label = "p.format",size = 3,method='wilcox')
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
df_mut_count_az_sel <- dft
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV","Placebo"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F,ylim = c(0, 11.5)) ##,ylim = c(0, 11.5)
#stat_compare_means(aes(group = Agent), label = "p.format",size = 3,method='wilcox')
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
df_mut_count_az_sel <- dft
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV","Placebo"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F,ylim = c(0, 11.5))+ ##,ylim = c(0, 11.5)
stat_compare_means(aes(group = Agent), label = "p.format",size = 3,method='wilcox')
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
df_mut_count_az_sel <- dft
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV","Placebo"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F,ylim = c(0, 11.5))+ ##,ylim = c(0, 11.5)
stat_compare_means(aes(group = Agent))
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
df_mut_count_az_sel <- dft
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV","Placebo"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F,ylim = c(0, 11.5))+ ##,ylim = c(0, 11.5)
stat_compare_means(aes(group = Agent), label = "p.format",size = 1,method='wilcox')
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
df_mut_count_az_sel <- dft
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV","Placebo"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F,ylim = c(0, 11.5))+ ##,ylim = c(0, 11.5)
stat_compare_means(aes(group = Agent), label = "p.format",size = 4,method='wilcox')
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
df_mut_count_az_sel <- dft
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV","Placebo"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F,ylim = c(0, 11.5))+ ##,ylim = c(0, 11.5)
stat_compare_means(aes(group = Agent), size = 4,method='wilcox')
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
df_mut_count_az_sel <- dft
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV","Placebo"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F,ylim = c(0, 11.5))+ ##,ylim = c(0, 11.5)
stat_compare_means(aes(group = Agent), label = "p.format",size = 4,method='wilcox')
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
df_mut_count_az_sel <- dft
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV","Placebo"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F)+ ##,ylim = c(0, 11.5)
stat_compare_means(aes(group = Agent), label = "p.format",size = 4,method='wilcox')
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
df_mut_count_az_sel <- dft
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV","Placebo"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F) ##,ylim = c(0, 11.5)
#stat_compare_means(aes(group = Agent), label = "p.format",size = 4,method='wilcox')
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
df_mut_count_az_sel <- dft
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV","Placebo"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F)+ ##,ylim = c(0, 11.5)
stat_compare_means(aes(group = Agent), label = "p.format",size = 4)
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
df_mut_count_az_sel <- dft
pd = position_dodge(width = 0.73)
data2plot <- df_mut_count_az_sel
data2plot$TR01PG1 <- factor(data2plot$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV","Placebo"))
ggboxplot(data2plot, x = "Perc_cat", y = "Count",width=0.5,
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,xlab = " ",ylab = "Emerging non-synonymous count", show.legend = F)+ ##,ylim = c(0, 11.5)
stat_compare_means(aes(group = Agent), label = "p.format",size = 4)
# theme(axis.text.x=element_blank(),
#     axis.ticks.x=element_blank())
data2plot
ggsave('/Users/rinkideo/Partners HealthCare Dropbox/Rinki Deo/RDEO_iMAC/VL_project/AZ_RD/NEW_ANALYSIS_2023/gt5freq_heatmaps/mut_count_newplot_feb_2025.pdf')
test_data
View(test_data)
View(plot_data)
plot_data = df_vl_np_withd0vlgt2
# Sort by multiple columns
plot_data <- plot_data[order(plot_data$SUBJID,plot_data$AVISITN ),]
plot_data$TR01PG1 <- factor(plot_data$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV", "Placebo"))
##Daywise Viral load plot
ggboxplot(plot_data, x = "AVISITN", y = "AVAL",
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,size=0.2)+
labs(y= "Viral Load (log10 SARS-CoV-2 RNA copies/mL)", x="Study Day")+
coord_cartesian(ylim = c(0, 10), clip = "off")+
scale_y_continuous(label = ~ scales::comma(.x, accuracy = 1))+
stat_compare_means(aes(group = TR01PG1), label = "p.format",size = 3) ##, method='wilcox'
##ggsave('~/Dropbox (Partners HealthCare)/RDEO_iMAC/VL_project/AZ_RD/NEW_ANALYSIS_2023/Daywise_absolute_Vkinetics_NP_d0quantifiable.pdf')
##Filetering in only the NPH vl data
df_vl_np = subset(df_admbvl, MBLOC %in% c('NASOPHARYNX') & AVISITN %in% c(0,3,7,14,28)) #NASAL CAVITY, NASOPHARYNX & AVISITN %in% c(0,3,7,14,28)
#df_vl_np = subset(df_admbvl, MBLOC %in% c('NASAL CAVITY') & AVISITN <8)
##VL data for only those PID who has d0 present
pids_with_d0 = subset(df_vl_np, AVISITN %in% c(0))
df_vl_np_withd0 = subset(df_vl_np, SUBJID %in% unique(pids_with_d0$SUBJID))
##VL data for only those PID who has d0 vl>2
pids_with_d0vlgt2 = subset(pids_with_d0, AVAL>1.7)
df_vl_np_withd0vlgt2 = subset(df_vl_np_withd0, SUBJID %in% unique(pids_with_d0vlgt2$SUBJID))
df_vl_np_withd0$AVISITN <- as.factor(df_vl_np_withd0$AVISITN)
df_vl_np_withd0vlgt2$visit <- as.factor(df_vl_np_withd0vlgt2$AVISITN)
df_vl_np$AVISITN <- as.factor(df_vl_np$AVISITN)
df_vl_np
plot_data = df_vl_np_withd0vlgt2
# Sort by multiple columns
plot_data <- plot_data[order(plot_data$SUBJID,plot_data$AVISITN ),]
plot_data$TR01PG1 <- factor(plot_data$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV", "Placebo"))
##Daywise Viral load plot
ggboxplot(plot_data, x = "AVISITN", y = "AVAL",
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5,size=0.2)+
labs(y= "Viral Load (log10 SARS-CoV-2 RNA copies/mL)", x="Study Day")+
coord_cartesian(ylim = c(0, 10), clip = "off")+
scale_y_continuous(label = ~ scales::comma(.x, accuracy = 1))+
stat_compare_means(aes(group = TR01PG1), label = "p.format",size = 3) ##, method='wilcox'
##ggsave('~/Dropbox (Partners HealthCare)/RDEO_iMAC/VL_project/AZ_RD/NEW_ANALYSIS_2023/Daywise_absolute_Vkinetics_NP_d0quantifiable.pdf')
test_data<- subset(plot_data,AVISITN %in% c(7) )
test_data1 <- subset(test_data, TR01PG1 %in% c('AZD7442 600 mg IM', 'Placebo')) ###AZD7442 600 mg IM, AZD7442 300 mg IV
test_data %>% kruskal_test(AVAL ~ TR01PG1)
#
res<- t.test(AVAL ~ TR01PG1, data = test_data1, var.equal = TRUE)
res
res$conf.int
res$estimate[1] - res$estimate[2]
wilcox_test(test_data, AVAL ~ TR01PG1, p.adjust.method = "hochberg" ,detailed = TRUE)
# a=subset(test_data, TR01PG1 %in% c('AZD7442 600 mg IM'))$AVAL
# b=subset(test_data, TR01PG1 %in% c('Placebo'))$AVAL
#res1<- wilcox.test(AVAL ~ TR01PG1, data = test_data, var.equal = TRUE)
test_data
test_data_OR = subset(test_data, TR01PG1 %in% c('AZD7442 600 mg IM','Placebo'))
test_data_OR
test_data_OR = subset(test_data, TR01PG1 %in% c('AZD7442 600 mg IM','Placebo'))
test_data_OR
test_data_IM = subset(test_data, TR01PG1 %in% c('AZD7442 600 mg IM'))
test_data_IM
test_data_IM = subset(test_data, TR01PG1 %in% c('AZD7442 600 mg IM'))
test_data_IM$AVAL
test_data_IM = subset(test_data, TR01PG1 %in% c('AZD7442 600 mg IM'))
test_data_IM$AVAL
test_data_Pl = subset(test_data, TR01PG1 %in% c('Placebo'))
test_data_Pl$AVAL
test_data_forOR = subset(test_data, TR01PG1 %in% c('AZD7442 600 mg IM','Placebo'))
test_data_forORL
test_data_forOR = subset(test_data, TR01PG1 %in% c('AZD7442 600 mg IM','Placebo'))
test_data_forOR
# test_data_IM = subset(test_data, TR01PG1 %in% c('AZD7442 600 mg IM'))
# test_data_IM$AVAL
#
# test_data_Pl = subset(test_data, TR01PG1 %in% c('Placebo'))
# test_data_Pl$AVAL
library(oddsratio)
library(epitools)
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_forOR)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
library(oddsratio)
library(epitools)
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_forOR)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
summary(fit_glm)
library(oddsratio)
library(epitools)
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_forOR)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
summary(fit_glm)
library(epiDisplay)
logistic.display(fit_glm)
data2plot = subset(df_admbvl, AVISITN %in% c(0,3,7,14,28) & MBLOC=='NASOPHARYNX') # & SUBJID %in% unique(df_AZ_IV_PIDs$PID)) ##& primstr=='NPH'
#data2plot = subset(df_admbvl, AVISITN <28 & MBLOC=='NASAL CAVITY') ###For all day plot in case of NAS swab
test_pids_withd0 = subset(data2plot, AVISITN %in% c(0))
##Only qunatifiable vl at d0
test_pids_withd0 <- subset(test_pids_withd0, AVAL >1.7)
data2plot_test <- subset(data2plot, SUBJID %in% unique(test_pids_withd0$SUBJID))
tmp1= subset(data2plot_test, AVISITN %in% c(0))
tmp1 <- subset(tmp1, select = c("SUBJID","AVAL"))
tmp1 <- tmp1 %>%
rename("d0_vl"="AVAL")
tmp2 = merge(x=data2plot_test, y= tmp1, by.x='SUBJID', by.y = "SUBJID", all.x = TRUE)
tmp2$d0_diffvl <- tmp2$AVAL- tmp2$d0_vl
data_2plot_withdiffvl <- subset(tmp2,AVISITN %in% c(3,7,14,28))
#data_2plot_withdiffvl <- subset(tmp2,AVISITN <8 & AVISITN >0) ###For all day plot in case of NAS swab
#data2plot_test <- transform(data2plot_test, (d0_diffvl=final_quanti- d0_vl))
#data_2plot_withdiffvl_iv <- data_2plot_withdiffvl[data_2plot_withdiffvl$SUBJID %in% unique(df_AZ_IV_PIDs$PID), ]
#data_2plot_withdiffvl_im <- data_2plot_withdiffvl[data_2plot_withdiffvl$SUBJID %in% unique(df_AZ_IM_PIDs$PID), ]
data_2plot_sel1 <- data_2plot_withdiffvl
#data_2plot_sel1 <- subset(data_2plot_withdiffvl, !TR01PG1 %in% c('Placebo'))
data_2plot_sel <- subset(data_2plot_sel1, !AVISITN %in% c('14','28'))
data_2plot_sel$AVISITN <- as.factor(data_2plot_sel$AVISITN)
data_2plot_sel$TR01PG1 <- factor(data_2plot_sel$TR01PG1,     # Reorder factor levels
c( "AZD7442 600 mg IM","AZD7442 300 mg IV", "Placebo"))
pp<- ggboxplot(data_2plot_sel, x = "AVISITN", y = "d0_diffvl",
add.params = list(size = 1.5, alpha = 0.9),
color = "TR01PG1",fill='TR01PG1', palette = "jco",
add = "jitter", alpha=0.5, notch=FALSE,width=0.5)
pp<- pp + stat_compare_means(aes(group = TR01PG1), label = "p.format",size = 3)+
labs(y= "Diff_VL wrt d0  (log10 SARS-CoV-2 RNA copies/mL)", x="Study Day")+
#coord_cartesian(ylim = c(0, 5), clip = "off")+
scale_y_continuous(label = ~ scales::comma(.x, accuracy = 1))+
guides(color=guide_legend(ncol=3))
# theme(
#   legend.position = c(1.027, -0.2),
#   legend.justification = c("right", "top"),
#   legend.box.just = "right",
#   legend.margin = margin(6,6,6,6)
#   )
pp
#ggsave('~/Dropbox (Partners HealthCare)/RDEO_iMAC/VL_project/AZ_RD/NEW_ANALYSIS_2023/Daywise_VL_diff_IV_vs_IM_plot_May23.pdf')
test_data_diff<- subset(data_2plot_sel,AVISITN %in% c(3) )
test_data_diff %>% kruskal_test(d0_diffvl ~ TR01PG1)
res_1diff <- dunn_test(test_data_diff,d0_diffvl ~ TR01PG1, p.adjust.method = "hochberg")
res_1diff
test_data_diff
test_data_diff
test_data_diff
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_diff)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
summary(fit_glm)
logistic.display(fit_glm)
test_data_diff
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_diff)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
#exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
#summary(fit_glm)
#logistic.display(fit_glm)
test_data_diff_1 = subset(test_data_diff, TR01PG1 %in% c('AZD7442 600 mg IM','Placebo'))
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_diff)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
#exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
#summary(fit_glm)
#logistic.display(fit_glm)
test_data_diff_1 = subset(test_data_diff, TR01PG1 %in% c('AZD7442 600 mg IM','Placebo'))
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_diff)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
#summary(fit_glm)
#logistic.display(fit_glm)
test_data_diff_1 = subset(test_data_diff, TR01PG1 %in% c('AZD7442 600 mg IM','Placebo'))
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_diff)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
#summary(fit_glm)
logistic.display(fit_glm)
test_data_diff_1 = subset(test_data_diff, TR01PG1 %in% c('AZD7442 600 mg IM','Placebo'))
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_diff_1)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
#summary(fit_glm)
logistic.display(fit_glm)
test_data_diff_1 = subset(test_data_diff, TR01PG1 %in% c('AZD7442 600 mg IM','Placebo'))
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_diff)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
#summary(fit_glm)
logistic.display(fit_glm)
test_data_diff_1 = subset(test_data_diff, TR01PG1 %in% c('AZD7442 600 mg IM','Placebo'))
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_diff_1)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
#summary(fit_glm)
logistic.display(fit_glm)
test_data_diff_1 = subset(test_data_diff, TR01PG1 %in% c('AZD7442 600 mg IM','Placebo'))
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_diff_1)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
#summary(fit_glm)
logistic.display(fit_glm)
test_data_diff_1 = subset(test_data_diff, TR01PG1 %in% c('AZD7442 300 mg IV','Placebo'))
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_diff_1)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
#summary(fit_glm)
logistic.display(fit_glm)
test_data_diff<- subset(data_2plot_sel,AVISITN %in% c(7) )
test_data_diff %>% kruskal_test(d0_diffvl ~ TR01PG1)
res_1diff <- dunn_test(test_data_diff,d0_diffvl ~ TR01PG1, p.adjust.method = "hochberg")
res_1diff
test_data_diff_1 = subset(test_data_diff, TR01PG1 %in% c('AZD7442 300 mg IV','Placebo'))
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_diff_1)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
#summary(fit_glm)
logistic.display(fit_glm)
test_data_diff_1 = subset(test_data_diff, TR01PG1 %in% c('AZD7442 600 mg IM','Placebo'))
fit_glm <- glm(TR01PG1 ~ AVAL, family = binomial, data = test_data_diff_1)
OR = exp(coef(fit_glm)) ### exp(fit_glm$coefficients)
OR
exp(cbind("Odds ratio" = coef(fit_glm), confint.default(fit_glm, level = 0.95)))
#summary(fit_glm)
logistic.display(fit_glm)
rm(list=ls())
R.version
library(DESeq2)
rm(list=ls())
library(Seurat)
library(Seurat)
install.packages("Seurat")
install.packages("Seurat")
install.packages("SeuratObject")
library(Seurat)
# Load libraries
library(Seurat)
library(tidyverse)
library(ggalluvial)
library(Matrix)
# Load Seurat object
seurat <- readRDS("./GPA2/seurat_rna_citeseq_GPA2.rds")
colnames(seurat@meta.data)
# Violin plots for RNA QC
VlnPlot(seurat, features = c("nFeature_RNA", "nCount_RNA"), pt.size = 0.1, ncol = 2)
VlnPlot(seurat, features = c("nFeature_ADT", "nCount_ADT"), pt.size = 0.1, ncol = 2, assay = "ADT")
##RNA Feature Count vs Total Count
FeatureScatter(seurat, feature1 = "nCount_RNA", feature2 = "nFeature_RNA")
##RNA vs ADT: Total Count
FeatureScatter(seurat, feature1 = "nCount_RNA", feature2 = "nCount_ADT")
##RNA vs ADT: Total Count
FeatureScatter(seurat, feature1 = "nCount_RNA", feature2 = "nCount_ADT")
